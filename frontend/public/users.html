<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>üë• Gest√£o de Usu√°rios - BSQA Card Writer</title>
  
  <!-- Preload de componentes cr√≠ticos -->
  <link rel="preload" href="components/header.html" as="fetch" crossorigin>
  <link rel="preload" href="components/footer.html" as="fetch" crossorigin>
  
  <link rel="stylesheet" href="assets/style.css">
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
</head>
<body>
  <div id="header" data-testid="users-header-container"></div>
  <div class="skeleton skeleton-header"></div>
  
  <div class="container" data-testid="users-main-container">
    <!-- Breadcrumbs -->
    <div class="breadcrumbs" data-testid="users-breadcrumbs-container">
      <!-- Breadcrumbs ser√£o preenchidos dinamicamente -->
    </div>
    
    <div class="users-page-header">
      <div>
        <h1 data-testid="users-title">üë• Gest√£o de Usu√°rios</h1>
        <p class="subtitle" data-testid="users-subtitle">Gerencie usu√°rios do sistema BSQA Card Writer</p>
      </div>
      <button class="btn-primary" id="btnNewUser" data-testid="users-button-new">
        ‚ûï Novo Usu√°rio
      </button>
    </div>

    <!-- Filtros -->
    <div class="users-filters">
      <div class="filter-group">
        <label for="filterStatus">Status:</label>
        <select id="filterStatus">
          <option value="">Todos</option>
          <option value="true" selected>Ativos</option>
          <option value="false">Inativos</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="filterPerfil">Perfil:</label>
        <select id="filterPerfil">
          <option value="">Todos</option>
          <option value="admin">Admin</option>
          <option value="user">User</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="searchInput">Buscar:</label>
        <input type="text" id="searchInput" placeholder="Nome, email ou username...">
      </div>
      <button class="btn-secondary" id="btnRefresh" title="Recarregar lista">
        üîÑ
      </button>
    </div>

    <!-- Tabela de Usu√°rios -->
    <div class="users-table-container" data-testid="users-table-container">
      <div id="loadingUsers" class="loading-message" style="display: none;">
        <div class="spinner"></div>
        <p>Carregando usu√°rios...</p>
      </div>
      
      <div id="errorUsers" class="error-message" style="display: none;"></div>
      
      <table class="users-table" id="usersTable">
        <thead>
          <tr>
            <th>Perfil</th>
            <th>Nome Completo</th>
            <th>Username</th>
            <th>Email</th>
            <th>Empresa</th>
            <th>CPF</th>
            <th>Status</th>
            <th>√öltimo Login</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="usersTableBody">
          <!-- Linhas ser√£o preenchidas dinamicamente -->
        </tbody>
      </table>
      
      <div id="emptyUsers" class="empty-message" style="display: none;">
        <p>üì≠ Nenhum usu√°rio encontrado</p>
      </div>
    </div>

    <!-- Estat√≠sticas -->
    <div class="users-stats" id="usersStats">
      <div class="stat-card">
        <span class="stat-icon">üë•</span>
        <div>
          <div class="stat-value" id="statTotal">-</div>
          <div class="stat-label">Total de Usu√°rios</div>
        </div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">‚úÖ</span>
        <div>
          <div class="stat-value" id="statActive">-</div>
          <div class="stat-label">Usu√°rios Ativos</div>
        </div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">‚ùå</span>
        <div>
          <div class="stat-value" id="statInactive">-</div>
          <div class="stat-label">Usu√°rios Inativos</div>
        </div>
      </div>
      <div class="stat-card">
        <span class="stat-icon">üëë</span>
        <div>
          <div class="stat-value" id="statAdmins">-</div>
          <div class="stat-label">Administradores</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para Criar/Editar Usu√°rio -->
  <div id="userModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">‚ûï Novo Usu√°rio</h2>
        <button class="modal-close" id="closeModal">&times;</button>
      </div>
      
      <form id="userForm" class="user-form">
        <input type="hidden" id="userId">
        
        <div class="form-row">
          <div class="form-group">
            <label for="nomeCompleto">Nome Completo <span class="required">*</span></label>
            <input type="text" id="nomeCompleto" required minlength="3" maxlength="100">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="username">Username <span class="required">*</span></label>
            <input type="text" id="username" required minlength="3" maxlength="50">
            <small>Apenas letras, n√∫meros, pontos, h√≠fens e underscores</small>
          </div>
          
          <div class="form-group">
            <label for="email">Email <span class="required">*</span></label>
            <input type="email" id="email" required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="empresa">Empresa</label>
            <input type="text" id="empresa" maxlength="100">
          </div>
          
          <div class="form-group">
            <label for="cpf">CPF <span class="required">*</span></label>
            <input type="text" id="cpf" required maxlength="14" placeholder="000.000.000-00">
            <small>Ser√° validado automaticamente</small>
          </div>
        </div>
        
        <div class="form-row" id="senhaRow">
          <div class="form-group">
            <label for="senha">Senha <span class="required">*</span></label>
            <input type="password" id="senha" minlength="8" maxlength="64">
            <small>M√≠nimo 8 caracteres, mai√∫scula, min√∫scula, n√∫mero e caractere especial</small>
          </div>
          
          <div class="form-group">
            <label for="confirmarSenha">Confirmar Senha <span class="required">*</span></label>
            <input type="password" id="confirmarSenha" minlength="8" maxlength="64">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="perfil">Perfil <span class="required">*</span></label>
            <select id="perfil" required>
              <option value="user">User</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="ativo">Status <span class="required">*</span></label>
            <select id="ativo" required>
              <option value="true">Ativo</option>
              <option value="false">Inativo</option>
            </select>
          </div>
        </div>
        
        <div id="formError" class="error-message" style="display: none; margin-top: 1rem;"></div>
        
        <div class="modal-footer">
          <button type="button" class="btn-secondary" id="btnCancelModal">Cancelar</button>
          <button type="submit" class="btn-primary" id="btnSaveUser">
            <span id="btnSaveText">üíæ Salvar</span>
            <span id="btnSaveLoading" style="display: none;">‚è≥ Salvando...</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <div id="footer" data-testid="users-footer-container"></div>
  <div class="skeleton skeleton-footer"></div>
  
  <!-- Prote√ß√£o de Autentica√ß√£o (Admin Only) -->
  <script type="module">
    import { requireAdmin } from './js/auth.js';
    
    // Proteger p√°gina - apenas admin pode acessar
    (async () => {
      await requireAdmin();
    })();
  </script>
  
  <script type="module" src="js/main.js"></script>
  <script type="module" src="js/users.js"></script>
</body>
</html>

