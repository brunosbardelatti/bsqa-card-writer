<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>BSQA Card Writer - Bug/Sub-Bug</title>
  
  <!-- Preload de componentes crÃ­ticos -->
  <link rel="preload" href="components/header.html" as="fetch" crossorigin>
  <link rel="preload" href="components/footer.html" as="fetch" crossorigin>
  
  <link rel="stylesheet" href="assets/style.css">
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
</head>
<body>
  <div id="header" data-testid="bug-header-container"></div>
  <div class="skeleton skeleton-header"></div>
  <div class="container" data-testid="bug-main-container">
    <!-- Breadcrumbs -->
    <div class="breadcrumbs" data-testid="bug-breadcrumbs-container">
      <!-- Breadcrumbs serÃ£o preenchidos dinamicamente -->
    </div>
    
    <h1 data-testid="bug-title">ğŸ› Abertura de Bug/Sub-Bug</h1>
    <p class="subtitle" data-testid="bug-subtitle">Descreva o problema encontrado e gere um Bug/Sub-Bug estruturado no Jira</p>
    
    <form id="bugForm" data-testid="bug-form">
      <!-- Select Tipo de Issue -->
      <div class="form-group" data-testid="bug-form-group-issue-type">
        <label for="issue_type" data-testid="bug-label-issue-type">
          ğŸ“‹ Tipo de Issue
        </label>
        <select id="issue_type" name="issue_type" required data-testid="bug-select-issue-type">
          <option value="bug" data-testid="bug-option-bug">ğŸ› Bug</option>
          <option value="sub_bug" data-testid="bug-option-sub-bug">ğŸ”— Sub-Bug</option>
        </select>
      </div>
      
      <!-- Input Issue Pai (visÃ­vel apenas para Sub-Bug) -->
      <div class="form-group" id="parent-key-group" style="display: none;" data-testid="bug-form-group-parent-key">
        <label for="parent_key" data-testid="bug-label-parent-key">
          ğŸ”— Issue Pai
        </label>
        <input 
          type="text" 
          id="parent_key" 
          name="parent_key" 
          placeholder="Ex: PKGS-1160"
          pattern="^[A-Z]+-\d+$"
          data-testid="bug-input-parent-key"
        >
        <small class="hint" data-testid="bug-hint-parent-format">Formato: PROJETO-NUMERO (ex: PKGS-1160)</small>
      </div>
      
      <!-- Input Projeto -->
      <div class="form-group" data-testid="bug-form-group-project">
        <label for="project_key" data-testid="bug-label-project">
          ğŸ“ Projeto
        </label>
        <input 
          type="text" 
          id="project_key" 
          name="project_key" 
          placeholder="Ex: PKGS"
          pattern="^[A-Z]+$"
          required
          data-testid="bug-input-project"
        >
        <small class="hint" data-testid="bug-hint-project-format">Apenas letras maiÃºsculas (ex: PKGS)</small>
      </div>
      
      <!-- Textarea DescriÃ§Ã£o -->
      <label style="width: 100%;" data-testid="bug-label-description">
        <textarea 
          id="description" 
          name="description" 
          rows="10" 
          placeholder="Descreva o problema encontrado. Inclua:
- DescriÃ§Ã£o do problema
- Severidade
- Prioridade
- Ambiente/Browser/VersÃ£o do app
- Passos para reproduzir
- Resultado esperado vs Resultado obtido
- Logs e evidÃªncias"
          required
          data-testid="bug-textarea-description"
        ></textarea>
      </label>
      
      <!-- Upload de Anexos (mÃºltiplos arquivos) -->
      <div class="form-group" data-testid="bug-form-group-attachments">
        <label data-testid="bug-label-attachments">
          ğŸ“ Anexos (EvidÃªncias)
        </label>
        <div class="drop-zone" id="attachmentsDropZone" data-testid="bug-drop-zone-attachments">
          Arraste e solte arquivos aqui (vÃ­deos, imagens, logs, ZIP)<br>
          <span style="color: #ffffff; text-decoration: underline;">Escolha arquivos</span>
          <input 
            type="file" 
            id="attachmentsInput" 
            name="attachments" 
            multiple
            accept="image/*,video/*,.log,.txt,.zip,.rar,.7z,.gz"
            data-testid="bug-file-input-attachments"
          >
          <div class="drop-feedback" id="attachmentsFeedback" style="display:none;" data-testid="bug-drop-feedback-attachments"></div>
          <button 
            class="drop-remove-btn" 
            id="attachmentsRemoveBtn" 
            style="display:none;" 
            title="Remover todos os arquivos" 
            data-testid="bug-button-remove-attachments"
          >Ã—</button>
        </div>
        <small class="hint" data-testid="bug-hint-attachments">Tipos aceitos: Imagens, VÃ­deos, Logs (.log, .txt), Arquivos compactados (.zip, .rar, .7z, .gz). Tamanho mÃ¡ximo: 100MB por arquivo.</small>
      </div>
      
      <!-- Select IA -->
      <div class="form-group" data-testid="bug-form-group-ai">
        <label for="ai_service" data-testid="bug-label-ai-service">
          ğŸ¤– ServiÃ§o de IA
        </label>
        <select id="ai_service" name="ai_service" required data-testid="bug-select-ai-service">
          <option value="" data-testid="bug-option-ai-loading">Carregando...</option>
        </select>
      </div>
      
      <!-- BotÃ£o Submit -->
      <button type="submit" class="submit-btn" data-testid="bug-button-submit">
        ğŸš€ Criar Bug/Sub-Bug
      </button>
    </form>
    
    <!-- Ãrea de Resultado -->
    <div id="output" data-testid="bug-output-container"></div>
  </div>
  <div id="footer" data-testid="bug-footer-container"></div>
  <div class="skeleton skeleton-footer"></div>
  <script type="module" src="js/main.js"></script>
  <script src="js/apiConfig.js"></script>
  <script type="module" src="js/bug.js"></script>
</body>
</html>
