<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ðŸ“Š Dashboard QA - BSQA Card Writer</title>
  
  <!-- Preload de componentes crÃ­ticos -->
  <link rel="preload" href="components/header.html" as="fetch" crossorigin>
  <link rel="preload" href="components/footer.html" as="fetch" crossorigin>
  
  <link rel="stylesheet" href="assets/style.css">
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
  
  <!-- Chart.js para grÃ¡ficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  
  <!-- jsPDF + html2canvas para geraÃ§Ã£o de PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <!-- Modal de Login Jira -->
  <div id="jiraLoginModal" class="modal" data-testid="jira-login-modal">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="modal-close-btn" id="jiraLoginModalCloseBtn" title="Fechar" aria-label="Fechar">&times;</button>
        <h2 id="jiraLoginModalTitle">Conectar ao Jira</h2>
        <p class="modal-subtitle" id="jiraLoginModalSubtitle">Informe suas credenciais para acessar o Dashboard</p>
      </div>

      <div id="jiraLoginUserSummary" class="jira-login-user-summary hidden" aria-hidden="true">
        <div class="jira-summary-row">
          <span class="jira-summary-label">InstÃ¢ncia</span>
          <span class="jira-summary-instance">â€”</span>
        </div>
        <div class="jira-summary-row">
          <span class="jira-summary-label">UsuÃ¡rio</span>
          <span class="jira-summary-name">â€”</span>
        </div>
        <div class="jira-summary-row">
          <span class="jira-summary-label">Email</span>
          <span class="jira-summary-email">â€”</span>
        </div>
      </div>
      
      <form id="jiraLoginForm" class="modal-form">
        <fieldset class="modal-form-section">
          <legend class="modal-form-legend">Credenciais</legend>
          <div class="form-group">
            <label for="jiraBaseUrl">URL do Jira *</label>
            <input type="url" id="jiraBaseUrl" placeholder="https://sua-empresa.atlassian.net" />
            <small class="field-hint">Ex: https://sua-empresa.atlassian.net</small>
          </div>
          <div class="form-group">
            <label for="jiraEmail">Email do Jira *</label>
            <input type="email" id="jiraEmail" placeholder="seu.email@empresa.com" />
          </div>
          <div class="form-group">
            <label for="jiraToken">Token de API *</label>
            <input type="password" id="jiraToken" placeholder="Seu token de API" />
            <small class="field-hint">
              <a href="https://id.atlassian.com/manage-profile/security/api-tokens" target="_blank" rel="noopener">Gerar token no Atlassian</a>
            </small>
          </div>
          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" id="rememberSession" checked />
              <span>Lembrar durante esta sessÃ£o</span>
            </label>
          </div>
        </fieldset>
        
        <fieldset class="modal-form-section import-credentials">
          <legend class="import-credentials-legend">
            <span class="import-credentials-title">Importar credenciais</span>
          </legend>
          <input type="file" id="jiraImportFile" accept=".json,application/json" hidden />
          <div class="import-paste-area">
            <textarea id="jiraImportJson" placeholder='Cole o JSON e clique em Conectar: {"baseUrl":"https://...","email":"...","token":"..."}' rows="3"></textarea>
            <button type="button" class="import-submit-btn" id="jiraImportFileBtn" title="Selecionar arquivo JSON">Importar</button>
          </div>
        </fieldset>
        
        <div id="jiraLoginError" class="error-message" style="display: none;"></div>
        
        <div class="modal-form-actions">
          <button type="submit" class="submit-btn" id="jiraLoginBtn" data-testid="jira-login-submit">
            <span class="btn-text">Conectar</span>
            <span class="btn-loading" style="display: none;">Conectando...</span>
          </button>
        </div>
      </form>
      
      <div class="modal-footer">
        <small>Suas credenciais sÃ£o armazenadas apenas no seu navegador e nÃ£o sÃ£o enviadas para nosso servidor.</small>
      </div>
    </div>
  </div>

  <div id="header" data-testid="dashboard-header-container"></div>
  <div class="skeleton skeleton-header"></div>
  
  <div class="container" data-testid="dashboard-main-container">
    <!-- Breadcrumbs -->
    <div class="breadcrumbs" data-testid="dashboard-breadcrumbs-container"></div>
    
    <!-- TÃ­tulo -->
    <h1 data-testid="dashboard-title">ðŸ“Š Dashboard de MÃ©tricas QA</h1>
    <p class="subtitle" data-testid="dashboard-subtitle">Visualize mÃ©tricas de performance da equipe de QA com dados do Jira</p>
    
    <!-- SeÃ§Ã£o de Filtros -->
    <div class="filters-section" data-testid="dashboard-filters-section">
      <h2>Filtros</h2>
      <form id="dashboardFilters" data-testid="dashboard-filters-form">
        <div class="filters-row">
          <!-- Projeto -->
          <div class="form-group">
            <label for="projectSearch" data-testid="dashboard-label-project">Projeto *</label>
            <div class="searchable-select" data-testid="dashboard-select-project">
              <input type="text" id="projectSearch" placeholder="Digite para buscar..." autocomplete="off" />
              <input type="hidden" id="projectKey" name="projectKey" required />
              <div class="select-dropdown" id="projectDropdown">
                <div class="select-option loading">Carregando projetos...</div>
              </div>
            </div>
          </div>
          
          <!-- PerÃ­odo -->
          <div class="form-group">
            <label for="periodType" data-testid="dashboard-label-period">PerÃ­odo *</label>
            <select id="periodType" name="periodType" required data-testid="dashboard-select-period">
              <option value="month_current">MÃªs Atual</option>
              <option value="month_previous">MÃªs Passado</option>
              <option value="last_3_months">Ãšltimos 3 Meses</option>
              <option value="sprint_current">Sprint Atual</option>
              <option value="sprint_previous">Sprint Passada</option>
              <option value="custom">PerÃ­odo Personalizado</option>
            </select>
          </div>
        </div>
        
        <!-- Campos de data customizada (visÃ­veis apenas quando period=custom) -->
        <div class="filters-row custom-dates-row" id="customDatesRow" style="display: none;">
          <div class="form-group">
            <label for="startDate" data-testid="dashboard-label-startdate">Data Inicial *</label>
            <input type="date" id="startDate" name="startDate" data-testid="dashboard-input-startdate">
          </div>
          <div class="form-group">
            <label for="endDate" data-testid="dashboard-label-enddate">Data Final *</label>
            <input type="date" id="endDate" name="endDate" data-testid="dashboard-input-enddate">
          </div>
        </div>
        
        <!-- Checkbox Status Time -->
        <div class="filters-row">
          <div class="form-group checkbox-group">
            <label class="checkbox-label" data-testid="dashboard-label-statustime">
              <input type="checkbox" id="includeStatusTime" name="includeStatusTime" data-testid="dashboard-checkbox-statustime">
              <span>Incluir Status Time na geraÃ§Ã£o</span>
              <small>(tempo em "Ready to test" e "In Test" - pode demorar mais)</small>
            </label>
          </div>
        </div>
        
        <!-- BotÃ£o Gerar -->
        <div class="filters-row">
          <button type="submit" class="submit-btn" id="generateBtn" data-testid="dashboard-btn-generate">
            ðŸš€ Gerar Dashboard
          </button>
        </div>
      </form>
    </div>
    
    <!-- Ãrea de Resultados -->
    <div id="dashboardOutput" class="dashboard-output" data-testid="dashboard-output-container">
      <!-- ConteÃºdo serÃ¡ preenchido dinamicamente -->
      <div class="empty-state" data-testid="dashboard-empty-state">
        <p>Selecione um projeto e perÃ­odo para gerar o dashboard.</p>
      </div>
    </div>
  </div>

  <div id="footer" data-testid="dashboard-footer-container"></div>
  <div class="skeleton skeleton-footer"></div>
  
  <script type="module" src="js/main.js"></script>
  <script src="js/apiConfig.js"></script>
  <script type="module" src="js/dashboard.js"></script>
</body>
</html>
